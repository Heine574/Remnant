<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="/Remnant/style.css">
<title>The Remnant</title>
</head>
<body style="margin:0px; overflow: hidden; font-family: devinneSwash;" unselectable="on">

<img id="map" src="map.jpg", style="display: none;">
<img id="city" src="cities.png", style="display: none;">

<fieldset onselectstart="return false" id="field" style="height: 80px; margin:0px; text-align: center; box-shadow: 0px 0px;">
<legend><b>The Remnant</b></legend>
	<a id="borderbtn" onclick=toggleborders()>Hide Labels</a>
</fieldset>
<canvas id="canvas" tabindex=0 width=400 height=400 style="margin:0px; border:0px solid #000000; left:0px; top:0px; cursor: auto;"></canvas></canvas>

<script>
var x = 0;
var y = 0;
var size = 1;
var mouseDown = false;
var mouseX;
var mouseY;
var clickX;
var clickY;
var oldX = x;
var oldY = y;
var selX;
var selY;
var showborders = true;
var selectedCity = "none";
var c = document.getElementById("canvas");
var f = document.getElementById("field");

var mapImg = null;
var cityImg = null;

/* NAME  X  Y  SIZE COUNTRY */
var cities = {
	"Thalgur": [-340.2, 251.5, 3, "Hilwahr"],
	"Nomgur": [-322.8, 278.6, 3, "Hilwahr"],
	"Dhularum": [-214.6, 329.7, 18, "Hilwahr"],
	"Nir Dor": [-175.1, 290.4, 4, "Hilwahr"],
};

window.onload = function() {
    var ctx = c.getContext("2d");
    mapImg = document.getElementById("map");
    cityImg = document.getElementById("city");
   	ctx.drawImage(mapImg, 10, 10);

	resize();
};

canvas.addEventListener('mousemove', function(evt) {
	var mousePos = getMousePos(canvas, evt);
	mouseX = mousePos.x - Math.round(canvas.width/2);
	mouseY = canvas.height - (mousePos.y + Math.round(canvas.height/2));
	selX = x+mouseX/size;
	selY = y+mouseY/size;
	if (mouseDown) {
		//console.log(mouseX-clickX, mouseY-clickY);
		x = oldX - ((mouseX-clickX) / size);
		y = oldY - ((mouseY-clickY) / size);
		draw(x, y, size);
	}
} );

canvas.addEventListener('wheel', function(evt) {
	if (evt.deltaY>0) {
		size /= 1.5;
	} else {
		size *= 1.5;
	}
	update();
} );

canvas.onmousedown = function(evt) {
	var mousePos = getMousePos(canvas, evt);
	clickX = mousePos.x - Math.round(canvas.width/2);
	clickY = canvas.height - (mousePos.y + Math.round(canvas.height/2));
	console.log(Math.round(selX), Math.round(selY));
	mouseDown = true;
	selectedPlanet = "none";
	update();
}
canvas.onmouseup = function(evt) {
	var mousePos = getMousePos(canvas, evt);
	mouseDown = false;
	oldX = x;
	oldY = y;
}

/*canvas.onclick = function() {
	var mousePos = getMousePos(canvas, evt);
	clickX = mousePos.x - Math.round(canvas.width/2);
	clickY = canvas.height - (mousePos.y + Math.round(canvas.height/2));
	console.log(clickX, clickY)
}*/

window.addEventListener("resize", resize);

function getMousePos( canvas, evt ) {
    var rect = canvas.getBoundingClientRect();
	pos = {
        x: Math.floor( ( evt.clientX - rect.left ) / ( rect.right - rect.left ) * canvas.width ),
        y: Math.floor( ( evt.clientY - rect.top ) / ( rect.bottom - rect.top ) * canvas.height )
    }
	//console.log(pos)
    return pos;
}

function toggleborders() {
	showborders = !showborders;
	b = document.getElementById("borderbtn");
	if (showborders) {
		b.text = "Hide Labels"
	} else {
		b.text = "Show Labels"
	}
	update();
}

function resize() {
	c.width = window.innerWidth;
	c.height = window.innerHeight-80;
	//f.width = window.innerWidth+10;
	draw(x, y, size);
}

function update() {
	draw(x, y, size);
}

function distance(x1, y1, x2, y2) {
	return Math.sqrt((x2-x1)**2 + (y2-y1)**2)
}

function draw(x, y, size) {
	var ctx = c.getContext("2d");

	ctx.fillStyle = "#000000";
	ctx.strokeStyle = "#101010";
	ctx.font = "2.5px devinneSwash";
	ctx.globalAlpha = 1;

    //ctx.imageSmoothingEnabled = false;
	ctx.setTransform(1,0,0,1,0,0);
	ctx.clearRect(0, 0, c.width, c.height);
	ctx.translate(c.width/2, c.height/2);
	ctx.scale(size, size);
	//drawPoint(ctx, 0, 0, x, y, "none");
   	ctx.drawImage(mapImg, 0-x-(1024), 0+y-(768));

   	for (i in cities) {
   		city = cities[i];
   		ctx.fillStyle = "#0000FF";
		ctx.beginPath();
		ctx.arc(city[0]-x, -city[1]+y, city[2], 0, 2 * Math.PI);
		ctx.fill();

		ctx.font = city[2] + "px devinneSwash";
		ctx.fillStyle = "#404040";
   		ctx.fillText(i, city[0]-x-(ctx.measureText(i).width/2)+(0.03*city[2]), -city[1]+y-(city[2]+2)+(0.03*city[2]));
		ctx.fillStyle = "#000000";
   		ctx.fillText(i, city[0]-x-(ctx.measureText(i).width/2), -city[1]+y-(city[2]+2));
	}

	ctx.globalAlpha = 0.8;

   	ctx.drawImage(cityImg, 0-x-(1024), 0+y-(768));

	ctx.fillStyle = "#000000";
	ctx.beginPath();
	ctx.arc(0, 0, 2, 0, 2 * Math.PI);
	ctx.fill();

	ctx.font = "2.5px devinneSwash";
   	ctx.fillText((Math.round(x*10)/10) + ", " + (Math.round(y*10)/10), 5, 0);
}

function get(path, params, cache=true, responseType="text", async=true) {
	//console.log(path, params, cache, responseType, async);
    var xhttp = new XMLHttpRequest();
	if (cache) {
		txt = ['t=' + Math.random().toString()];
	}
	else {
		txt = [];
	}
	for (i in params) {
		txt.push(i + '=' + params[i]);
	}
	if (async) {
	data = "wait";
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				data = this.response;
				//console.log(data);
			}
		};
	}
	txt = "?" + txt.join('&');
	xhttp.open("GET", path + txt, async);
	if (async) {xhttp.responseType = responseType;}
	//xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.send();
	if (!async) {return xhttp.responseText;}
}

//by Juan Mendes
function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
  if (typeof stroke === 'undefined') {
    stroke = true;
  }
  if (typeof radius === 'undefined') {
    radius = 5;
  }
  if (typeof radius === 'number') {
    radius = {tl: radius, tr: radius, br: radius, bl: radius};
  } else {
    var defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};
    for (var side in defaultRadius) {
      radius[side] = radius[side] || defaultRadius[side];
    }
  }
  ctx.beginPath();
  ctx.moveTo(x + radius.tl, y);
  ctx.lineTo(x + width - radius.tr, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
  ctx.lineTo(x + width, y + height - radius.br);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
  ctx.lineTo(x + radius.bl, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
  ctx.lineTo(x, y + radius.tl);
  ctx.quadraticCurveTo(x, y, x + radius.tl, y);
  ctx.closePath();
  if (fill) {
    ctx.fill();
  }
  if (stroke) {
    ctx.stroke();
  }

}
</script>


</body>
</html>
